#{extends 'main.html' /}
#{set title:messages.get(report.reportType.name) /}

<ul class="breadcrumb">
  <li><a href="@{Orders.index}">&{'orders'}</a> <span class="divider">/</span></li>
  <li><a href="@{Orders.show(report.order.id)}">${report.order.description}</a> <span class="divider">/</span></li>
  <li class="active">#{get 'title' /}</li>
</ul>

<h1>#{get 'title' /}</h1>

<dl>
    <dt>&{'order.description'}</dt>
    <dd>${report.order.description}</dd>

    <dt>&{'order.orderStatus'}</dt>
    <dd>#{orderStatus report.order /}</dd>

    <dt>&{'order.orderingContact.id'}</dt>
    <dd><a href="@{Contacts.show(report.order.orderingContact.id)}">${report.order.orderingContact?.label}</a></dd>

    <dt>&{'order.shippingContact.id'}</dt>
    <dd><a href="@{Contacts.show(report.order.shippingContact.id)}">${report.order.shippingContact?.label}</a></dd>

    <dt>&{'order.billingContact.id'}</dt>
    <dd><a href="@{Contacts.show(report.order.billingContact.id)}">${report.order.billingContact?.label}</a></dd>
</dl>


#{if report.currentReport}
<h2>&{'workflow'}</h2>
<div class="well">
    #{if report.order.orderStatus.toString() == 'IN_PROGRESS'}
    #{list items:report.reportType.reportTransitions, as:'reportTransition'}
    <a href="@{confirmTransition(report.id, reportTransition.id)}"
       class="btn primary"
       modal="modal">&{'create', reportTransition.targetReportType.name}</a>
    #{/list}
    #{/if}
    #{if (report.order.orderStatus.toString() == 'NEW' || report.order.orderStatus.toString() == 'IN_PROGRESS')}
        <a href="@{Orders.confirmFinish(report.order.id)}"
           class="btn success"
           modal="modal">&{'finish'}</a>
        <a href="@{Orders.confirmAbort(report.order.id)}"
           class="btn danger"
           modal="modal">&{'abort'}</a>
    #{/if}
</div>
#{/if}

<h2>&{'functions'}</h2>
<div class="well">
    <a href="@{download(report.id)}" class="btn primary">&{'downloadPdf'}</a>
</div>

#{if report.currentReport && report.order.orderStatus.toString() == 'IN_PROGRESS'}
<h2>&{'reportItems'}</h2>
<div class="well">
    <a href="@{MetricProductReportItems.create(report.id)}" class="btn primary">&{'create', messages.get('metricProductReportItem')}</a>
    <a href="@{PrecalculatedProductReportItems.create(report.id)}" class="btn primary">&{'create', messages.get('precalculatedProductReportItem')}</a>
    <a href="@{AdditionalReportItems.create(report.id)}" class="btn primary">&{'create', messages.get('additionalReportItem')}</a>
</div>
#{/if}

<table class="zebra-striped">
    <thead>
        <tr>
            <th>&{'reportItem.amount'}</th>
            <th>&{'reportItem.metric.symbol'}</th>
            <th>&{'reportItem.description'}</th>
            <th>&{'reportItem.pricePerUnit'}</th>
            <th>&{'reportItem.totalPrice'}</th>
            <th>&{'reportItem.taxedTotalPrice'}</th>
            <th>&{'actions'}</th>
        </tr>
    </thead>
    <tbody>
        #{list items:report.reportItems, as:'reportItem'}
        <tr>
            <td>${reportItem.amount}</td>
            <td>${reportItem.metric.symbol}</td>
            <td>${reportItem.description?.raw()}</td>
            <td>${reportItem.pricePerUnit}</td>
            <td>${reportItem.totalPrice}</td>
            <td>${reportItem.taxedTotalPrice}</td>
            <td>
                #{if report.currentReport && report.order.orderStatus.toString() == 'IN_PROGRESS'}
                <a href="@{reportItemForm(reportItem.id)}">&{'edit'}</a>
                #{/if}
            </td>
        </tr>
        #{/list}
    </tbody>
</table>

<table class="zebra-striped">
    <tbody>
        <tr>
            <td><strong>&{'report.totalPrice'}</strong></td>
            <td>${report.totalPrice.label}</td>
        </tr>
        <tr>
            <td><strong>&{'report.tax'}</strong></td>
            <td>${report.tax.label}</td>
        </tr>
        <tr>
            <td><strong>&{'report.taxedTotalPrice'}</strong></td>
            <td>${report.taxedTotalPrice.label}</td>
        </tr>
    </tbody>
</table>

<div id="modal" class="modal fade hide"></div>


